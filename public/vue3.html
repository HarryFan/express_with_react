<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue 3 Todo List</title>
  <!-- 引入 Vue 3 CDN -->
  <script src="https://unpkg.com/vue@next"></script>
  <!-- 引入 axios CDN -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!-- 引入 Bootstrap CDN for better UI -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    body {

      background-color: #f0f0f0;
      color: #333;

      padding: 50px;
      font: 14px "Lucida Grande", Helvetica, Arial, sans-serif;
    }

    #app {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      background-color: #fff;
    }

    h2 {
      color: #333;
      text-align: center;
    }

    .input-todo {
      width: 80%;
      padding: 5px;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <div id="app" class="container">
    <h2 class="my-3">Vue3 待辦事項</h2>

    <!-- 輸入待辦事項 -->
    <div class="input-group mb-3">
      <input v-model="newTodoText" class="form-control input-todo" placeholder="輸入待辦事項">
      <!-- 新增待辦事項按鈕 -->
      <div class="input-group-append">
        <button @click="addTodo" class="btn btn-outline-secondary">新增</button>
      </div>
    </div>

    <!-- 待辦事項列表 -->
    <ul class="list-group">
      <li v-for="todo in todos" class="list-group-item d-flex justify-content-between align-items-center">
        {{ todo.text }}
        <div>
          <!-- 編輯待辦事項按鈕 -->
          <button @click="setEditingTodo(todo)" class="btn btn-outline-primary btn-sm">編輯</button>
          <!-- 點擊按鈕時呼叫 setEditingTodo 方法並傳入當前的 todo -->
          <!-- 刪除待辦事項按鈕 -->
          <button @click="deleteTodo(todo.id)" class="btn btn-outline-danger btn-sm ml-2">刪除</button>
          <!-- 點擊按鈕時呼叫 deleteTodo 方法並傳入待辦事項的 id -->
        </div>
      </li>
    </ul>

    <!-- 編輯待辦事項區塊 -->
    <div v-if="editingTodo" class="input-group mt-3">
      <!-- 當 editingTodo 為真時顯示此區塊 -->
      <input v-model="editingTodo.text" class="form-control input-todo" placeholder="編輯待辦事項"> <!-- 雙向綁定正在編輯的待辦事項的文字 -->
      <!-- 更新待辦事項按鈕 -->
      <div class="input-group-append">
        <button @click="updateTodo" class="btn btn-outline-secondary">更新</button> <!-- 點擊按鈕時呼叫 updateTodo 方法 -->
      </div>
    </div>
  </div>



  <script>
    const {
      createApp,
      ref,
      onMounted
    } = Vue

    const app = createApp({
      setup() {
        const newTodoText = ref('') // 新待辦事項文字
        const editingTodo = ref(null) // 正在編輯的待辦事項
        const todos = ref([]) // 所有待辦事項

        // 取得所有待辦事項
        const getTodos = () => {
          axios.get('/todos')
            .then(res => {
              todos.value = res.data // 取得待辦事項後，更新 todos 陣列
            })
        }

        // 新增待辦事項
        const addTodo = () => {
          const text = newTodoText.value

          axios.post('/todos', {
              text
            })
            .then(res => {
              todos.value.push(res.data) // 新增待辦事項後，更新 todos 陣列
              newTodoText.value = ''
            })
        }

        // 刪除待辦事項
        const deleteTodo = id => {
          axios.delete(`/todos/${id}`)
            .then(() => {
              todos.value = todos.value.filter(t => t.id !== id) // 刪除待辦事項後，更新 todos 陣列
            })
        }

        // 設定正在編輯的待辦事項
        const setEditingTodo = (todo) => {
          editingTodo.value = todo;
        }


        // 更新待辦事項
        const updateTodo = () => {
          axios.put(`/todos/${editingTodo.value.id}`, {
              text: editingTodo.value.text
            })
            .then(res => {
              const index = todos.value.findIndex(t => t.id === editingTodo.value.id) // 取得原本的待辦事項在陣列中的索引值
              todos.value.splice(index, 1, res.data) // 刪除原本的待辦事項，並插入更新後的待辦事項
              editingTodo.value = null
            })
        }

        // 當元件掛載時，取得所有待辦事項
        onMounted(() => {
          getTodos()
        })

        return {
          newTodoText,
          editingTodo,
          todos,
          getTodos,
          addTodo,
          deleteTodo,
          setEditingTodo,
          updateTodo
        }
      }
    })

    // 掛載 Vue 應用程式
    app.mount('#app')
  </script>

</body>

</html>