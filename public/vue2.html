<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Vue Todo</title>
<!-- 引入Vue.js  -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>

<!-- 引入vueuse -->   
<script src="https://unpkg.com/@vueuse/shared"></script>
<script src="https://unpkg.com/@vueuse/core"></script>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div id="app">

        <h2>待辦事項</h2>
      
        <input v-model="newTodoText" placeholder="新增待辦事項">
      
        <button @click="addTodo">新增</button>
      
        <ul>
          <li v-for="todo in todos">
            {{ todo.text }}  
            <button @click="deleteTodo(todo.id)">刪除</button>
            <button @click="setEditingTodo(todo)">編輯</button>
          </li>
        </ul>
      
        <input v-model="editingTodo.text" v-if="editingTodo">
        <button @click="updateTodo" v-if="editingTodo">更新</button>
      
      </div>
      
      <script>
      const app = new Vue({
        el: '#app',
        
        data() {
          return {
            newTodoText: '',
            editingTodo: null,
            todos: []
          }
        },
      
        methods: {
          getTodos() {
            axios.get('/todos')
              .then(res => {
                this.todos = res.data
              }) 
          },
          
          addTodo() {
            const text = this.newTodoText
            
            axios.post('/todos', { text })
              .then(res => {
                this.todos.push(res.data)
                this.newTodoText = ''  
              })
          },
          
          deleteTodo(id) {
            axios.delete(`/todos/${id}`) 
              .then(() => {
                this.todos = this.todos.filter(t => t.id !== id)
              })
          },
          
          setEditingTodo(todo) {
            this.editingTodo = todo
          },
          
          updateTodo() {
            axios.put(`/todos/${this.editingTodo.id}`, {
              text: this.editingTodo.text
            })
              .then(res => {
                const index = this.todos.findIndex(t => t.id === this.editingTodo.id)
                this.todos.splice(index, 1, res.data)
                this.editingTodo = null
              })
          }
        },
      
        mounted() {
          this.getTodos()
        }
        
      })
      </script>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
    <script src="app.js"></script>
  </body>
</html>